<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Extjs - Google Earth - Helloworld</title>
<link rel="stylesheet" href="extjs/resources/css/ext-all.css"
	type="text/css"></link>
<link rel="stylesheet" type="text/css" href="ext-js-google-earth-api/Ext.ux.GEarthPanel-1.3.css" />
<style>

.play {
  background-image: url(famfamfam_silk_icons/icons/control_play.png) !important;
}

.pause {
  background-image: url(famfamfam_silk_icons/icons/control_pause.png) !important;
}

.rewind {
  background-image: url(famfamfam_silk_icons/icons/control_rewind.png) !important;
}
</style>
<script type="text/javascript" src="extjs/ext-all-dev.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
google.load("earth", "1");
google.load("maps", "2.xx");
var earth;
var gei;

Ext.Loader.setConfig({
    enabled: true,
    //disableCaching: false, // uncomment to use firebug breakpoints
    paths: {
      'Ext.ux': 'ux/'
    }
});

Ext.require([
   'Ext.window.Window',
   'Ext.form.field.Text',
   'Ext.form.field.ComboBox'
]);

Ext.useShims = true;

Ext.onReady(function() {
	// Use https://github.com/pymonger/ext-js-google-earth-api
	var earth = Ext.create('Ext.ux.GEarthPanel', {
		earthLayers: {
            LAYER_BUILDINGS: true,
            LAYER_TERRAIN: true
        },
        earthOptions: {
//            setStatusBarVisibility: false,
            setAtmosphereVisibility: true,
            setMouseNavigationEnabled: true,
            setStatusBarVisibility:    false,
            setGridVisibility:         false,
            setOverviewMapVisibility:  false,
            setScaleLegendVisibility:  false,
        }
	});

	var href = 'http://145.100.61.22/workspace4/ExtJS-Cesium/S355_museumplein.kml';

	var earth_options = Ext.create('Ext.window.Window', {
		title: 'Google Earth options',
		width: 280,
		height: 600,
        margins: '5 5 5 5',
        layout: 'accordion',
        layoutConfig: {
            animate: true
        },
        defaults: {
            bodyStyle: 'padding: 10px'
        }
	});

	earth.on('earthLoaded', function(){
        earth.getEarth().getNavigationControl().setVisibility(earth.getEarth().VISIBILITY_HIDE);
        earth.getEarth().getTime().getControl().setVisibility(earth.getEarth().VISIBILITY_HIDE);

		earth.fetchKml(href);
		earth.findLocation('Amsterdam');

		// Add panels
        earth_options.add(earth.getKmlPanel());
        earth_options.add(earth.getLocationPanel());
        earth_options.add(earth.getLayersPanel());
        earth_options.add(earth.getOptionsPanel());
        earth_options.doLayout();
        win.addTool({
			type: 'gear',
			tooltip: 'Options',
			handler: function() {
				earth_options.show();
			}
		});
	});

	win = Ext.create('Ext.window.Window', {
		width : 500,
		height : 500,
		title : 'Museumplein',
		layout: 'fit',
		maximizable: true,
		closeable: false,
		items: [earth],
		dockedItems: [{
		    xtype: 'toolbar',
		    dock: 'bottom',
		    items: [{
				iconCls: 'center',
				toolTip: 'Center',
				handler: function() {
					var av = earth.kmlFeature.getAbstractView();
					gei.getView().setAbstractView(av);
					var tp = earth.kmlFeature.getTimePrimitive();
					gei.getTime().setTimePrimitive(tp);
				}
			}, {
				iconCls: 'play',
				toolTip: 'Play',
				handler: function() {
					earth.ge.getTourPlayer().play();
				}
			}, {
				iconCls: 'pause',
				toolTip: 'Pause',
				handler: function() {
					earth.ge.getTourPlayer().pause();
				}
			}, {
				iconCls: 'rewind',
				toolTip: 'Rewind',
				handler: function() {
					earth.ge.getTourPlayer().reset();
				}
			}]
		}]
	});
	win.show();
});
</script>
</head>
<body>
	<div id="earthContainer"></div>
	<div>
	<h1>TODO</h1>
	<ol>
	<li>Externalize play controls</li>
	<li>Change appearance of track within a certain time range</li>
	<li>Click on point gives datetime of that point</li>
	</ol>
	</div>
</body>
</html>